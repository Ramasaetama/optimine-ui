!function(){"use strict";const e={state:{user:{name:"John Doe",email:"tidaktau@gmail.com",jobTitle:"Operations Manager",avatar:null},preferences:{notifications:!0},activities:[],isDirty:!1},init(){this.loadUserData(),this.bindEvents(),this.syncPreferences(),this.loadActivities()},loadUserData(){const e=localStorage.getItem("optimine-user");if(e)try{const t=JSON.parse(e);this.state.user={...this.state.user,...t}}catch(e){console.error("Error loading user data:",e)}const t=localStorage.getItem("optimine-preferences");if(t)try{const e=JSON.parse(t);this.state.preferences={...this.state.preferences,...e}}catch(e){console.error("Error loading preferences:",e)}this.updateProfileUI()},updateProfileUI(){const{user:e}=this.state,t=document.getElementById("profile-name"),i=document.getElementById("profile-job"),a=document.getElementById("user-email"),s=document.getElementById("nav-username");if(t&&(t.value=e.name),i&&(i.value=e.jobTitle),a&&(a.textContent=e.email),s&&(s.textContent=e.name),e.avatar){const t=document.getElementById("avatar-image"),i=document.querySelector("#avatar-preview svg");t&&(t.src=e.avatar,t.classList.remove("hidden"),i&&i.classList.add("hidden"))}},syncPreferences(){const e=localStorage.getItem("optimine-language")||"id";document.querySelectorAll(".lang-pref-btn").forEach(t=>{const i=t.dataset.lang===e;t.classList.toggle("active",i)});const t=document.documentElement.classList.contains("dark"),i=document.getElementById("theme-switch");i&&i.setAttribute("aria-checked",t.toString());const a=document.getElementById("notifications-switch");if(a){const e=this.state.preferences.notifications;a.setAttribute("aria-checked",e.toString())}},bindEvents(){const e=document.getElementById("profile-form");e&&e.addEventListener("submit",e=>this.handleSaveProfile(e));const t=document.getElementById("avatar-upload-btn"),i=document.getElementById("avatar-input");t&&i&&(t.addEventListener("click",()=>i.click()),i.addEventListener("change",e=>this.handleAvatarChange(e))),document.querySelectorAll(".lang-pref-btn").forEach(e=>{e.addEventListener("click",()=>this.handleLanguageChange(e.dataset.lang))});const a=document.getElementById("theme-switch");a&&a.addEventListener("click",()=>this.handleThemeToggle());const s=document.getElementById("notifications-switch");s&&s.addEventListener("click",()=>this.handleNotificationsToggle());const n=document.getElementById("logout-btn");n&&n.addEventListener("click",()=>this.handleLogout()),document.querySelectorAll(".profile-input").forEach(e=>{e.addEventListener("input",()=>{this.state.isDirty=!0})})},async handleSaveProfile(e){e.preventDefault();const t=document.getElementById("save-profile-btn"),i=document.getElementById("profile-name"),a=document.getElementById("profile-job"),s=i?.value.trim(),n=a?.value.trim();if(!s)return this.showToast("Please enter your full name","error"),void i?.focus();t&&(t.classList.add("loading"),t.disabled=!0),await this.delay(1e3),this.state.user.name=s,this.state.user.jobTitle=n||"",this.state.isDirty=!1,this.saveUserData(),this.updateProfileUI(),this.addActivity("profile_update","Profile updated successfully"),t&&(t.classList.remove("loading"),t.disabled=!1),this.showToast("Profile saved successfully!","success")},handleAvatarChange(e){const t=e.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/"))return void this.showToast("Please select an image file","error");if(t.size>5242880)return void this.showToast("Image size must be less than 5MB","error");const i=new FileReader;i.onload=e=>{const t=e.target?.result;if(t){this.state.user.avatar=t;const e=document.getElementById("avatar-image"),i=document.querySelector("#avatar-preview svg");e&&(e.src=t,e.classList.remove("hidden")),i&&i.classList.add("hidden"),this.saveUserData(),this.addActivity("avatar_update","Profile picture updated"),this.showToast("Avatar updated!","success")}},i.readAsDataURL(t)},handleLanguageChange(e){document.querySelectorAll(".lang-pref-btn").forEach(t=>{t.classList.toggle("active",t.dataset.lang===e)}),window.LanguageManager?window.LanguageManager.setLanguage(e):(localStorage.setItem("optimine-language",e),document.documentElement.lang=e),this.addActivity("language_change","Language changed to "+("en"===e?"English":"Indonesian")),this.showToast("Language changed to "+("en"===e?"English":"Indonesian"),"success")},handleThemeToggle(){const e=document.getElementById("theme-switch"),t=document.documentElement.classList.contains("dark");window.ThemeManager?window.ThemeManager.setTheme(t?"light":"dark"):(document.documentElement.classList.toggle("dark"),localStorage.setItem("optimine-theme",t?"light":"dark")),e&&e.setAttribute("aria-checked",(!t).toString()),this.addActivity("theme_change",`Theme changed to ${t?"light":"dark"} mode`)},handleNotificationsToggle(){const e=document.getElementById("notifications-switch"),t="true"===e?.getAttribute("aria-checked");this.state.preferences.notifications=!t,e&&e.setAttribute("aria-checked",(!t).toString()),this.savePreferences(),this.addActivity("notifications_toggle","Notifications "+(t?"disabled":"enabled")),this.showToast("Notifications "+(t?"disabled":"enabled"),"success")},handleLogout(){"function"==typeof window.handleLogout?window.handleLogout():(localStorage.removeItem("optimine-logged-in"),localStorage.removeItem("optimine-user"),localStorage.removeItem("optimine-redirect"),this.showToast("Logged out successfully","success"),setTimeout(()=>{window.location.href="index.html"},1e3))},saveUserData(){try{localStorage.setItem("optimine-user",JSON.stringify(this.state.user))}catch(e){console.error("Error saving user data:",e)}},savePreferences(){try{localStorage.setItem("optimine-preferences",JSON.stringify(this.state.preferences))}catch(e){console.error("Error saving preferences:",e)}},loadActivities(){const e=localStorage.getItem("optimine-activities");if(e)try{this.state.activities=JSON.parse(e),this.renderActivities()}catch(e){console.error("Error loading activities:",e)}},addActivity(e,t){const i={id:Date.now(),type:e,message:t,timestamp:(new Date).toISOString()};this.state.activities.unshift(i),this.state.activities.length>10&&(this.state.activities=this.state.activities.slice(0,10)),localStorage.setItem("optimine-activities",JSON.stringify(this.state.activities)),this.renderActivities()},renderActivities(){const e=document.getElementById("activity-empty"),t=document.getElementById("activity-list");if(t){if(0===this.state.activities.length)return e&&e.classList.remove("hidden"),void t.classList.add("hidden");e&&e.classList.add("hidden"),t.classList.remove("hidden"),t.innerHTML=this.state.activities.map(e=>{const t=this.getActivityIcon(e.type),i=this.formatTimeAgo(e.timestamp);return`\n                    <div class="activity-item">\n                        <div class="activity-icon">\n                            ${t}\n                        </div>\n                        <div class="activity-content">\n                            <p class="activity-title">${e.message}</p>\n                            <p class="activity-time">${i}</p>\n                        </div>\n                    </div>\n                `}).join("")}},getActivityIcon(e){const t={profile_update:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>',avatar_update:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>',language_change:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" /></svg>',theme_change:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>',notifications_toggle:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>',default:'<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'};return t[e]||t.default},formatTimeAgo(e){const t=new Date(e),i=new Date,a=Math.floor((i-t)/1e3);return a<60?"Just now":a<3600?`${Math.floor(a/60)} minutes ago`:a<86400?`${Math.floor(a/3600)} hours ago`:a<604800?`${Math.floor(a/86400)} days ago`:t.toLocaleDateString()},showToast(e,t="info"){if(window.Toast)return void window.Toast.show(e,t);const i=document.querySelector(".profile-toast");i&&i.remove();const a=document.createElement("div");a.className=`profile-toast fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up ${"success"===t?"bg-green-500":"error"===t?"bg-red-500":"bg-primary"} text-white font-medium`,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",a.style.transform="translateY(20px)",a.style.transition="all 0.3s ease-out",setTimeout(()=>a.remove(),300)},3e3)},delay:e=>new Promise(t=>setTimeout(t,e))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init(),window.ProfileManager=e}();